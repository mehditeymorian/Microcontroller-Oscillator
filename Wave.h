#include "stdint.h"



#define CLK (84000000.0)
#define RES (4096.0)
#define NS (128)
#define MAX_AMPLITUDE (10.0)

volatile static int wave_type = 0;
volatile static uint32_t amp_raw = 1;
volatile static uint32_t freq_raw = 1000;
volatile static double amplitude = 10.0;
volatile static double frequency = 2.0;
volatile static int32_t wave_scale = 0;



static uint32_t SINE_LUT[] = {2048,2148,2248,2348,2447,2545,2642,2737,
															2831,2923,3013,3100,3185,3267,3346,3423,
															3495,3565,3630,3692,3750,3804,3853,3898,
															3939,3975,4007,4034,4056,4073,4085,4093,
															4095,4093,4085,4073,4056,4034,4007,3975,
															3939,3898,3853,3804,3750,3692,3630,3565,
															3495,3423,3346,3267,3185,3100,3013,2923,
															2831,2737,2642,2545,2447,2348,2248,2148,
															2048,1947,1847,1747,1648,1550,1453,1358,
															1264,1172,1082,995,910,828,749,672,
															600,530,465,403,345,291,242,197,
															156,120,88,61,39,22,10,2,
															1,3,10,22,39,61,88,120,
															156,197,242,291,345,403,465,530,
															600,672,749,828,910,995,1082,1172,
															1264,1358,1453,1550,1648,1747,1847,1947};

static uint32_t TRIANGLE_LUT[] = {64,128,192,256,320,384,448,512,
																	576,640,704,768,832,896,960,1024,
																	1088,1152,1216,1280,1344,1408,1472,1536,
																	1600,1664,1728,1792,1856,1920,1984,2048,
	
																	2111,2175,2239,2303,2367,2431,2495,2559,
																	2623,2687,2751,2815,2879,2943,3007,3071,
																	3135,3199,3263,3327,3391,3455,3519,3583,
																	3647,3711,3775,3839,3903,3967,4031,4095,
	
																	4031,3967,3903,3839,3775,3711,3647,3583,
																	3519,3455,3391,3327,3263,3199,3135,3071,
																	3007,2943,2879,2815,2751,2687,2623,2559,
																	2495,2431,2367,2303,2239,2175,2111,2048,
	
																	1984,1920,1856,1792,1728,1664,1600,1536,
																	1472,1408,1344,1280,1216,1152,1088,1024,
																	960,896,832,768,704,640,576,512,
																	448,384,320,256,192,128,64,1};

static uint32_t SQUARE_LUT[]= {4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																4031,4095,4031,4095,4031,4095,4031,4095,
																1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
																1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
																1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
																1,1,1,1};

static uint32_t SAWTOOTH_LUT[]= {1,32,64,96,128,160,192,224,256,288,320,
																 352,384,416,448,480,512,544,576,608,640,
																 672,704,736,768,800,832,864,896,928,960,
																 992,1024,1056,1088,1120,1152,1184,1216,
																 1248,1280,1312,1344,1376,1408,1440,1472,
																 1504,1536,1568,1600,1632,1664,1696,1728,
																 1760,1792,1824,1856,1888,1920,1952,1984,
																 2016,2048,2080,2112,2144,2176,2208,2240,
																 2272,2304,2336,2368,2400,2432,2464,2496,
																 2528,2560,2592,2624,2656,2688,2720,2752,
																 2784,2816,2848,2880,2912,2944,2976,3008,
																 3040,3072,3104,3136,3168,3200,3232,3264,
																 3296,3328,3360,3392,3424,3456,3488,3520,
																 3552,3584,3616,3648,3680,3712,3744,3776,
																 3808,3840,3872,3904,3936,3968,4000,4032,4064};

static uint32_t STAIRS_LUT[]= {1,1,1,1,1,1,1,1,1,1,1,1,1,455,455,455,455,
															 455,455,455,455,455,455,455,455,455,
															 910,910,910,910,910,910,910,910,910,
															 910,910,910,910,1365,1365,1365,1365,
															 1365,1365,1365,1365,1365,1365,1365,
															 1365,1365,1820,1820,1820,1820,1820,
															 1820,1820,1820,1820,1820,1820,1820,
															 1820,2275,2275,2275,2275,2275,2275,
															 2275,2275,2275,2275,2275,2275,2275,
															 2730,2730,2730,2730,2730,2730,2730,
															 2730,2730,2730,2730,2730,2730,3185,
															 3185,3185,3185,3185,3185,3185,3185,
															 3185,3185,3185,3185,3185,3640,3640,
															 3640,3640,3640,3640,3640,3640,3640,
															 3640,3640,3640,3640,4095,4095,4095,
															 4095,4095,4095,4095,4095,4095,4095,4095};

static uint32_t RECTIFIED_SINE_LUT[] = {1,200,400,600,798,994,1188,1378,1566,1750,
																			  1930,2104,2274,2438,2596,2750,2894,
																			  3034,3164,3288,3404,3512,3610,3700,
																			  3782,3854,3918,3972,4016,4050,4074,
																			  4090,4094,4090,4074,4050,4016,3972,
																			  3918,3854,3782,3700,3610,3512,3404,
																			  3288,3164,3034,2894,2750,2596,2438,
																			  2274,2104,1930,1750,1566,1378,1188,
																			  994,798,600,400,200,1,200,400,600,
																			  798,994,1188,1378,1566,1750,1930,
																			  2104,2274,2438,2596,2750,2894,3034,
																			  3164,3288,3404,3512,3610,3700,3782,
																			  3854,3918,3972,4016,4050,4074,4090,
																			  4094,4090,4074,4050,4016,3972,3918,
																			  3854,3782,3700,3610,3512,3404,3288,
																			  3164,3034,2894,2750,2596,2438,2274,
																			  2104,1930,1750,1566,1378,1188,994,
																			  798,600,400,200};

static uint32_t SEGMENTED_SINE_LUT[] = {2048,2048,2048,2048,2048,2048,2048,2048,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				1,2,10,22,39,61,88,120,
																				156,197,242,291,345,403,465,530,
																				600,672,749,828,910,995,1082,1172,
																				1264,1358,1453,1550,1648,1747,1847,1947,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				2048,2048,2048,2048,2048,2048,2048,2048,
																				4095,4093,4085,4073,4056,4034,4007,3975,
																				3939,3898,3853,3804,3750,3692,3630,3565,
																				3495,3423,3346,3267,3185,3100,3013,2923,
																				2831,2737,2642,2545,2447,2348,2248,2148};

static uint32_t SINE_MODULATION_LUT[] = { 
																					2111,2175,2239,2303,2367,2431,2495,2559,
																					1984,1920,1856,1792,1728,1664,1600,1536,
																					2623,2687,2751,2815,2879,2943,3007,3071,
																					1472,1408,1344,1280,1216,1152,1088,1024,
																					3135,3199,3263,3327,3391,3455,3519,3583,
																					960,896,832,768,704,640,576,512,
																					3647,3711,3775,3839,3903,3967,4031,4095,
																					448,384,320,256,192,128,64,1,
																					64,128,192,256,320,384,448,512,
																					4031,3967,3903,3839,3775,3711,3647,3583,
																					576,640,704,768,832,896,960,1024,
																					3519,3455,3391,3327,3263,3199,3135,3071,
																					1088,1152,1216,1280,1344,1408,1472,1536,
																					3007,2943,2879,2815,2751,2687,2623,2559,
																					1600,1664,1728,1792,1856,1920,1984,2047,
																					2495,2431,2367,2303,2239,2175,2111,2048};
															

volatile static int index = 0;

void pwm_clock_init(void);

void pwm_init(void);

void tim2_init(void);
																				
														 

														 														 